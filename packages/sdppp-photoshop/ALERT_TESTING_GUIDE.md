# Alert 弹窗测试指南

## 📋 测试步骤

点击"从图层导入"按钮后，会依次弹出 **8个弹窗**，追踪整个执行流程。

---

## 🎯 预期的8个弹窗

### 第1个弹窗
```
[1/8] 函数开始
```
**说明**: 确认函数被调用

---

### 第2个弹窗
```
[2/8] 状态获取成功
activeDocID: 123
boundary: curlayer
maxImageSize: 999999
```
**检查**:
- `activeDocID` 应该是一个数字
- `boundary` 应该是 `curlayer`、`canvas` 或对象
- `maxImageSize` 应该是 `999999`（无限制）或其他数字

---

### 第3个弹窗
```
[3/8] 参数准备完成，即将调用 getImage
```
**说明**: 参数已准备好，即将调用 `getImage`

---

### 第4个弹窗
```
[4/8] getImage 成功
有source: true
有thumbnail: true
width: 1024
height: 1024
```
**关键检查**:
- `有source: true` ✅ 有完整分辨率文件
- `width` 和 `height` 应该是图层的实际尺寸（如 1024）

**如果显示**:
- `有source: false` ❌ → 这就是问题！没有source文件

---

### 第5个弹窗
```
[5/8] 数据验证完成
sourceUrl: 有
thumbnailUrl: 有
尺寸: 1024×1024
```
**关键检查**:
- `sourceUrl: 有` ✅
- `尺寸` 应该是完整分辨率

---

### 第6个弹窗
```
[6/8] 方案1:使用source
nativePath: C:/Users/.../xxx.png...
displayUrl: file:///C:/Users/.../xxx.png...
尺寸: 1024×1024
```
**关键检查**:
- 应该显示 "方案1:使用source" ✅
- `nativePath` 应该是有效的文件路径
- `displayUrl` 应该以 `file:///` 开头
- `尺寸` 保持完整分辨率

**如果看到**:
- `[6/8] 使用方案2: 降采样警告` ❌ → 会导致降采样

---

### 第7个弹窗
```
[7/8] 路径验证成功
nativePath有效: 是
displayUrl有效: 是
```
**说明**: 路径都有效

---

### 第8个弹窗（最重要！）
```
[8/8] 保存完成！
url: file:///C:/Users/.../xxx.pn...
thumbnail_url: file:///C:/Users/.../xxx.pn...
尺寸: 1024×1024
```
**关键检查**:
- `url` 和 `thumbnail_url` 都应该以 `file:///` 开头 ✅
- `尺寸` 保持完整分辨率 ✅

**这个弹窗显示后**:
- 预览区域应该**立即显示**图像
- **不应该**显示 "no preview"

---

## 🔍 问题诊断

### 场景1：在第4步就停止了

**表现**: 只看到前3个弹窗，第4个弹窗一直不出现

**原因**: `getImage` 调用卡住或崩溃

**解决**:
- 确保当前文档有打开的图层
- 确保图层是可见的
- 尝试重启 Photoshop

---

### 场景2：第4个弹窗显示 `有source: false`

**表现**:
```
[4/8] getImage 成功
有source: false  ❌
有thumbnail: true
width: 1024
height: 1024
```

**原因**: getImage 没有返回 source 文件

**这是根本问题！** 需要检查 SDK 或 PS 版本

---

### 场景3：第6个弹窗显示"方案2"

**表现**:
```
[6/8] 使用方案2: 降采样警告
```

**原因**: 没有 source，使用了 thumbnail_url

**结果**: 会降采样到 192×192

---

### 场景4：第8个弹窗显示，但预览仍然是 "no preview"

**表现**:
- 看到了 `[8/8] 保存完成！`
- `url` 和 `thumbnail_url` 看起来正确
- 但预览区域显示 "no preview"

**可能原因**:
1. `file:///` 路径格式不正确
2. 文件路径包含特殊字符
3. 文件不存在或已被删除
4. UXP 无法访问该路径

**调试**:
- 复制弹窗中的 `url`
- 手动在浏览器中打开（如果是文件路径）
- 检查文件是否存在

---

### 场景5：在某个步骤抛出异常

**表现**: 弹出 `❌ 异常: [错误消息]`

**原因**: 代码执行过程中发生了异常

**调试**: 查看错误消息内容

---

## 📝 测试报告模板

请按照以下格式提供测试结果：

```
测试环境:
- Photoshop 版本: 
- 图层尺寸: 

看到的弹窗序列:
[ ] [1/8] 函数开始
[ ] [2/8] 状态获取成功
[ ] [3/8] 参数准备完成
[ ] [4/8] getImage 成功
[ ] [5/8] 数据验证完成
[ ] [6/8] 方案1/方案2
[ ] [7/8] 路径验证成功
[ ] [8/8] 保存完成

第4个弹窗内容:
- 有source: ?
- 有thumbnail: ?
- width: ?
- height: ?

第6个弹窗内容:
- 使用的方案: ?

第8个弹窗内容:
- url前缀: ?
- thumbnail_url前缀: ?
- 尺寸: ?

最终结果:
[ ] 预览正常显示
[ ] 预览显示 "no preview"
[ ] 其他: ___________
```

---

## 🎯 成功的标志

如果一切正常，应该：

1. ✅ 依次看到8个弹窗
2. ✅ 第4个弹窗显示 `有source: true`
3. ✅ 第6个弹窗显示 "方案1:使用source"
4. ✅ 第8个弹窗显示 `url` 和 `thumbnail_url` 都是 `file:///` 开头
5. ✅ 预览区域立即显示图像（不是 "no preview"）

---

## 🚨 如果失败

根据在哪个步骤失败，可以精确定位问题：

- **第4步失败**: getImage 调用问题
- **第4步 source=false**: SDK 返回数据不完整
- **第6步使用方案2**: 降采样问题
- **第8步后仍no preview**: 显示/路径问题

